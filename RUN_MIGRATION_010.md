# 🔄 הוראות הרצת מיגרציה 010 - עדכון תוכניות ומחירים

## 📋 מה המיגרציה עושה:

1. **מעדכנת את הגבלות הדקות** לכל התוכניות:
   - יוצרים (creator): 30 דקות/חודש
   - יוצרים באקסטרים (pro): 100 דקות/חודש
   - מאמנים וסוכנויות (coach): 200 דקות/חודש
   - מאמנים וסוכנויות PRO (coach-pro): 300 דקות/חודש

2. **מעדכנת את תוכנית coach-pro**:
   - שם: "מאמנים, סוכנויות ובתי ספר למשחק"
   - תיאור: "יותר מתאמנים, יותר דקות ניתוח"
   - מחיר: 299 ש"ח/חודש (2,990 ש"ח/שנה)
   - עד 300 דקות בחודש
   - עד 30 מתאמנים

---

## 🚀 שלבים להרצת המיגרציה:

### 1. כניסה ל-Supabase Dashboard

1. **היכנס ל-Supabase Dashboard**: https://app.supabase.com
2. **בחר את הפרויקט שלך** (Viraly Production)
3. **לך ל-SQL Editor** בתפריט השמאלי

### 2. העתקת המיגרציה

1. **פתח את הקובץ**: `supabase/migrations/010_update_plans_pricing_and_minutes.sql`
2. **העתק את כל התוכן** (Ctrl+A, Ctrl+C)
3. **הדבק ב-SQL Editor** ב-Supabase

### 3. הרצת המיגרציה

1. **ודא שאתה בפרויקט הנכון** - בדוק את השם בראש הדף
2. **לחץ על כפתור "Run"** (או Ctrl+Enter)
3. **המתן להשלמת הביצוע** - אמור להופיע הודעת הצלחה

### 4. בדיקת התוצאות

לאחר הרצת המיגרציה, בדוק שהכל התעדכן:

```sql
-- בדוק את כל התוכניות
SELECT 
  tier, 
  name, 
  monthly_price, 
  max_video_minutes_per_period, 
  max_trainees
FROM public.plans
ORDER BY monthly_price;

-- בדוק את תוכנית coach-pro ספציפית
SELECT 
  tier, 
  name, 
  description, 
  monthly_price, 
  yearly_price,
  max_video_minutes_per_period,
  max_trainees
FROM public.plans
WHERE tier = 'coach-pro';
```

**תוצאות צפויות:**

| Tier | Name | Monthly Price | Minutes/Month | Trainees |
|------|------|---------------|---------------|----------|
| free | ניסיון | 0 | 0 | NULL |
| creator | יוצרים | 49 | 30 | NULL |
| pro | יוצרים באקסטרים | 99 | 100 | NULL |
| coach | מאמנים, סוכנויות ובתי ספר למשחק | 199 | 200 | 10 |
| coach-pro | מאמנים, סוכנויות ובתי ספר למשחק | 299 | 300 | 30 |

---

## ⚠️ חשוב לדעת:

1. **המיגרציה בטוחה להרצה** - היא משתמשת ב-`ON CONFLICT DO UPDATE`, כך שאם התוכנית כבר קיימת היא תתעדכן, ואם לא - היא תווצר.

2. **לא ימחקו נתונים** - המיגרציה רק מעדכנת את התוכניות, לא מוחקת משתמשים או מנויים קיימים.

3. **אפשר להריץ מספר פעמים** - אם תהריץ את המיגרציה שוב, היא פשוט תעדכן שוב את אותם נתונים (idempotent).

---

## 🔍 אם משהו לא עובד:

1. **בדוק את ה-Logs** ב-SQL Editor - תמיד מציג שגיאות אם יש
2. **ודא שהמיגרציה 006 כבר רצה** - זו המיגרציה שמוסיפה את העמודות `max_video_minutes_per_period` ו-`max_trainees`
3. **בדוק שהתוכנית קיימת** - אם `coach-pro` לא קיים, המיגרציה תיצור אותו

---

## ✅ אחרי הרצת המיגרציה:

1. **בדוק שהכל תקין** עם השאילתות שלמעלה
2. **בדוק באפליקציה** שהתוכניות מוצגות נכון
3. **ודא שהמחירים מוצגים נכון** ב-modal של בחירת תוכנית

---

## 📝 הערות:

- המיגרציה מעדכנת גם את המחירים השנתיים (yearly_price)
- אם תרצה לשנות משהו אחר כך, תוכל להריץ UPDATE ישירות או ליצור מיגרציה חדשה
- הקוד ב-`src/constants/index.ts` כבר מעודכן נכון, אז לא צריך לשנות שם כלום

---

**תאריך יצירה**: ינואר 2025  
**גרסת מיגרציה**: 010

